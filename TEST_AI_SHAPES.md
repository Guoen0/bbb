# AI 形状创建功能测试指南

## 🎯 测试目标

验证 AI 服务能够正确理解用户指令并在 tldraw 画布上创建相应的形状。

## 🧪 测试用例

### 1. 基本形状创建

#### 圆形测试
- **输入**：`画一个红色的圆形`
- **预期结果**：在画布上创建一个红色的椭圆形状
- **验证点**：
  - 形状类型：geo (ellipse)
  - 颜色：红色
  - 位置：随机位置（100-500, 100-400范围内）

#### 矩形测试
- **输入**：`创建一个绿色的矩形`
- **预期结果**：在画布上创建一个绿色的矩形形状
- **验证点**：
  - 形状类型：geo (rectangle)
  - 颜色：绿色
  - 尺寸：120x80

#### 文本测试
- **输入**：`添加文字"Hello World"`
- **预期结果**：在画布上创建文本形状
- **验证点**：
  - 形状类型：text
  - 内容：Hello World 或 "文本内容"

#### 箭头测试
- **输入**：`画一条箭头`
- **预期结果**：在画布上创建箭头形状
- **验证点**：
  - 形状类型：arrow
  - 起点和终点正确设置

### 2. 颜色识别测试

测试 AI 能否正确识别和应用颜色：

- `画一个蓝色的圆` → 蓝色圆形
- `创建黄色矩形` → 黄色矩形
- `添加紫色的方形` → 紫色矩形

### 3. 组合指令测试

- `画一个大的红色圆形和一个小的蓝色矩形`
- `创建三个不同颜色的形状`

### 4. 错误处理测试

- 无效指令：`随便说点什么`
- 模糊指令：`画点东西`
- 空消息：``

## 🔧 调试信息

### 控制台输出检查

1. **编辑器挂载**：
   ```
   Canvas mounted: [Editor object]
   ```

2. **AI 响应接收**：
   ```
   Canvas update received: { shapes: [...], bindings: [], assets: [] }
   ```

3. **形状创建**：
   - 检查是否有错误信息
   - 验证形状数据结构

### 常见问题排查

#### 问题1：画布上没有出现形状
- **检查**：控制台是否显示 "Canvas update received"
- **可能原因**：AI 服务没有生成 canvasUpdate
- **解决**：检查意图识别逻辑

#### 问题2：形状出现但属性不正确
- **检查**：形状数据结构是否符合 tldraw 格式
- **可能原因**：形状属性映射错误
- **解决**：检查 createShapeFromIntent 方法

#### 问题3：编辑器引用为空
- **检查**：editorRef.current 是否有值
- **可能原因**：onEditorMount 回调未正确设置
- **解决**：检查组件间的 props 传递

## 📝 测试步骤

1. **启动应用**：访问 http://localhost:3000
2. **打开开发者工具**：查看控制台输出
3. **输入测试指令**：在右侧聊天面板输入测试用例
4. **观察结果**：
   - 检查 AI 响应消息
   - 查看画布是否创建了形状
   - 验证形状属性是否正确
5. **记录结果**：记录成功/失败的测试用例

## ✅ 预期工作流程

1. 用户在聊天面板输入：`画一个红色的圆形`
2. AI 服务分析意图：识别为 create_shape (ellipse)
3. 生成形状数据：包含正确的类型、颜色、位置信息
4. 应用到画布：调用 editor.createShape() 创建形状
5. 用户看到：画布上出现红色圆形，AI 回复确认消息

## 🚀 成功标准

- ✅ 基本形状（圆形、矩形、文本、箭头）能正确创建
- ✅ 颜色识别和应用功能正常
- ✅ 形状出现在画布的合理位置
- ✅ AI 响应消息准确描述操作
- ✅ 无控制台错误信息
- ✅ 编辑器功能（缩放、选择等）正常工作